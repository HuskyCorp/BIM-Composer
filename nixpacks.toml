[phases.setup]
nixPkgs = [
    "...",                           # Extends default nixpacks packages
    "nodejs_20",
    "python311",
    "python311Packages.pip",
    "gcc",                           # Provides libstdc++.so (C++ standard library)
    "stdenv.cc.cc.lib",              # Runtime C++ libraries
    "zlib",                          # Compression library dependency
    "libGL",                         # OpenGL library
    "libGLU"                         # OpenGL Utility library
]

nixLibs = [
    "zlib",                          # Make available via LD_LIBRARY_PATH
    "stdenv.cc.cc.lib"               # Make C++ runtime available
]

[phases.install]
cmds = [
    "npm install",
    "python -m venv backend/python/venv",
    "backend/python/venv/bin/pip install --upgrade pip wheel",
    "backend/python/venv/bin/pip install --verbose -r backend/python/requirements.txt 2>&1 | tee /tmp/pip-install.log || (cat /tmp/pip-install.log && exit 1)",
    "backend/python/venv/bin/python backend/python/verify_install.py"
]

[start]
cmd = "node backend/server.js"