# Declare multiple providers explicitly for Node + Python hybrid project
providers = ["node", "python"]

[variables]
PYTHON_CMD = "python"                # Use same Python command as build phase

[phases.setup]
# Use "..." to extend auto-detected packages, not replace them
# Python provider already adds gcc, so we only add packages it doesn't
nixPkgs = ["...", "stdenv.cc.cc.lib", "zlib", "libGL", "libGLU"]

nixLibs = ["...", "zlib", "stdenv.cc.cc.lib"]

[phases.install]
cmds = [
    "npm install",
    # Use venv Python explicitly (Python provider creates it at /opt/venv)
    "/opt/venv/bin/pip install -r backend/python/requirements.txt",
    "/opt/venv/bin/python backend/python/verify_install.py"
]

[start]
cmd = "PYTHON_CMD=/opt/venv/bin/python node backend/server.js"
